name: PHP Tests

on: ['push', 'pull_request']

jobs:
  test:
    name: 'PHP ${{ matrix.php-version }}'

    runs-on: ubuntu-latest

    strategy:
      matrix:
        php-version: ['8.1', '8.2']

    steps:
      - uses: actions/checkout@v3
      - name: Use PHP ${{ matrix.php-version }}
        uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-version }}
      - name: Install dependencies
        run: make @php/deps
      - name: Run Tests
        run:  make @php/test
  check:
    name: 'Check Format & Types'

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Use PHP 8.1
      uses: shivammathur/setup-php@v2
      with:
        php-version: 8.1
    - name: Install dependencies
      run: make @php/deps
    - name: Lint
      run: make @php/lint
    - name: Typecheck
      run: make @php/types